---
phase: 11-testing-accessibility-validation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - playwright.config.ts
  - tests/accessibility/axe-tests.spec.ts
  - tests/accessibility/dark-mode.spec.ts
autonomous: true

must_haves:
  truths:
    - "Automated accessibility tests run on all major pages"
    - "axe-core detects WCAG violations automatically"
    - "Dark mode accessibility is tested separately"
    - "Tests can be run with npm script"
  artifacts:
    - path: "playwright.config.ts"
      provides: "Playwright test configuration"
      contains: "baseURL.*localhost"
    - path: "tests/accessibility/axe-tests.spec.ts"
      provides: "Page-level axe scans"
      contains: "AxeBuilder"
    - path: "tests/accessibility/dark-mode.spec.ts"
      provides: "Dark mode accessibility tests"
      contains: "theme-toggle"
    - path: "package.json"
      provides: "Test scripts"
      contains: "test:a11y"
  key_links:
    - from: "package.json"
      to: "playwright.config.ts"
      via: "npm script invokes playwright"
      pattern: "playwright test"
    - from: "tests/accessibility/axe-tests.spec.ts"
      to: "@axe-core/playwright"
      via: "AxeBuilder import"
      pattern: "import AxeBuilder"
---

<objective>
Set up automated accessibility testing infrastructure with Playwright and axe-core.

Purpose: Establish automated accessibility regression testing that catches ~57% of WCAG violations on every test run. This creates a safety net for future changes and validates current implementation.

Output: Playwright configuration, accessibility test suite covering all major pages, npm scripts to run tests.
</objective>

<execution_context>
@/Users/joel/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/11-testing-accessibility-validation/11-RESEARCH.md

Reference existing site structure:
@src/pages/index.astro
@src/pages/projects/index.astro
@src/pages/blog/index.astro
@src/pages/about.astro
@src/pages/contact.astro
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Playwright and axe-core dependencies</name>
  <files>package.json</files>
  <action>
Install Playwright and axe-core as dev dependencies:

```bash
npm install --save-dev @playwright/test @axe-core/playwright
npx playwright install chromium
```

Add test scripts to package.json:
- "test:a11y": "playwright test tests/accessibility"
- "test:a11y:ui": "playwright test tests/accessibility --ui"

Do NOT install browsers for all platforms - only chromium is needed for accessibility testing.
  </action>
  <verify>
- `npm run test:a11y --help` shows Playwright help
- `grep "@axe-core/playwright" package.json` returns match
- `grep "@playwright/test" package.json` returns match
  </verify>
  <done>Playwright and axe-core installed, npm scripts available for running accessibility tests</done>
</task>

<task type="auto">
  <name>Task 2: Create Playwright configuration and accessibility test suite</name>
  <files>
    playwright.config.ts
    tests/accessibility/axe-tests.spec.ts
    tests/accessibility/dark-mode.spec.ts
  </files>
  <action>
Create playwright.config.ts at project root:
- baseURL: http://localhost:4321
- testDir: ./tests
- webServer: starts dev server on port 4321
- Use only chromium (accessibility testing doesn't need cross-browser)
- Timeout: 30 seconds per test

Create tests/accessibility/axe-tests.spec.ts:
- Import AxeBuilder from @axe-core/playwright
- Test all major pages: /, /projects, /blog, /about, /contact
- Use WCAG 2.2 AA tags: ['wcag2a', 'wcag2aa', 'wcag21a', 'wcag21aa', 'wcag22aa']
- Each page gets its own test
- Include color-contrast rule explicitly
- Pattern from research:
  ```typescript
  const results = await new AxeBuilder({ page })
    .withTags(['wcag2a', 'wcag2aa', 'wcag21a', 'wcag21aa'])
    .analyze();
  expect(results.violations).toEqual([]);
  ```

Create tests/accessibility/dark-mode.spec.ts:
- Test dark mode accessibility separately (per research recommendation)
- Toggle dark mode via [data-theme-toggle] button
- Run axe scan in dark mode
- Verify no color contrast regressions in dark mode
- Wait for transition after toggle (500ms per research)
  </action>
  <verify>
Run tests against dev server:
1. Start dev server: `npm run dev` (in background)
2. Wait for server ready
3. Run: `npm run test:a11y`
4. All tests should pass (or report specific WCAG violations to fix)
  </verify>
  <done>
Playwright configured with test suite covering:
- Homepage accessibility (light mode)
- Projects page accessibility
- Blog page accessibility
- About page accessibility
- Contact page accessibility
- Dark mode accessibility for homepage
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify Lighthouse CI baseline still passes</name>
  <files>None (verification only)</files>
  <action>
Run Lighthouse CI locally to verify existing 90% thresholds still pass after v1.1 design changes:

1. Build the site: `npm run build`
2. Run Lighthouse CI: `npx @lhci/cli autorun`

If any category fails below 90%:
- Document the specific failure (which metric, which page)
- Note in SUMMARY.md as a finding for investigation
- Do NOT try to fix - this plan is for validation, not fixes

Expected result: All categories >= 90% (performance, accessibility, best-practices, SEO)
  </action>
  <verify>
Lighthouse CI output shows:
- categories:performance >= 90%
- categories:accessibility >= 90%
- categories:best-practices >= 90%
- categories:seo >= 90%
  </verify>
  <done>Lighthouse CI validation confirms site meets or exceeds 90% thresholds across all categories, or specific failures documented for follow-up</done>
</task>

</tasks>

<verification>
1. `npm run test:a11y` executes without configuration errors
2. All accessibility tests pass OR violations are documented
3. Lighthouse CI passes 90% thresholds OR failures documented
4. Tests can run in CI environment (no interactive prompts)
</verification>

<success_criteria>
- Playwright + axe-core installed and configured
- Accessibility tests cover 5+ major pages
- Dark mode has dedicated accessibility tests
- npm scripts available: test:a11y, test:a11y:ui
- Lighthouse CI validation completed
- Any WCAG violations documented (not necessarily fixed - this is validation phase)
</success_criteria>

<output>
After completion, create `.planning/phases/11-testing-accessibility-validation/11-01-SUMMARY.md`
</output>
