---
phase: 11-testing-accessibility-validation
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/styles/global.css
  - src/components/About.astro
  - src/components/homepage/ContactSection.astro
  - src/pages/projects/index.astro
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Yellow statistics text in About section meets WCAG 3:1 contrast ratio for large text"
    - "Turquoise email link in Contact section meets WCAG 4.5:1 contrast ratio for normal text"
    - "Dark mode filter buttons on Projects page have visible text contrast"
  artifacts:
    - path: "src/styles/global.css"
      provides: "WCAG-compliant text color variants"
      contains: "color-yellow-text"
    - path: "src/components/About.astro"
      provides: "Accessible stat numbers"
      contains: "text-yellow-text"
    - path: "src/components/homepage/ContactSection.astro"
      provides: "Accessible email link"
      contains: "text-turquoise-text"
    - path: "src/pages/projects/index.astro"
      provides: "Visible inactive filter buttons in dark mode"
      contains: "dark:text-text-dark"
  key_links:
    - from: "About.astro"
      to: "global.css"
      via: "text-yellow-text utility class"
      pattern: "text-yellow-text"
    - from: "ContactSection.astro"
      to: "global.css"
      via: "text-turquoise-text utility class"
      pattern: "text-turquoise-text"
---

<objective>
Fix WCAG color contrast violations identified during Phase 11 accessibility testing.

Purpose: Address 3 contrast violations that prevent full WCAG 2.2 AA compliance:
1. Yellow statistics (#f3cb00) at 1.57:1 ratio (requires 3:1 for large text)
2. Turquoise email link (#00babb) at 2.4:1 ratio (requires 4.5:1 for normal text)
3. Dark mode filter buttons with low-contrast inactive state

Output: WCAG-compliant text color tokens and updated components
</objective>

<execution_context>
@/Users/joel/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-testing-accessibility-validation/11-VERIFICATION.md
@src/styles/global.css
@src/components/About.astro
@src/components/homepage/ContactSection.astro
@src/pages/projects/index.astro
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add WCAG-compliant text color tokens to design system</name>
  <files>src/styles/global.css</files>
  <action>
Add new OKLCH color tokens specifically for text that meet WCAG contrast requirements:

1. In the @theme block, add new text-specific color variants:
   - `--color-yellow-text`: Darker yellow that achieves 3:1+ contrast on white
     - Target: oklch(0.55 0.15 95) - L reduced from 0.85 to ~0.55 for 3:1+ ratio
   - `--color-turquoise-text`: Darker turquoise that achieves 4.5:1+ contrast on white
     - Target: oklch(0.45 0.12 195) - L reduced from 0.70 to ~0.45 for 4.5:1+ ratio
   - `--color-yellow-text-dark`: Dark mode variant for yellow text (lighter to contrast against dark bg)
     - Target: oklch(0.85 0.18 95) - same as original yellow (works on dark bg)
   - `--color-turquoise-text-dark`: Dark mode variant for turquoise text
     - Target: oklch(0.70 0.15 195) - same as original turquoise (works on dark bg)

2. Do NOT modify existing color tokens - they're used for decorative elements (shadows, borders, backgrounds) where contrast requirements are different.

3. The text variants follow OKLCH design principle: reduce L (lightness) to increase contrast on white, or increase L for dark mode contrast.

Contrast math verification:
- White background is oklch(1.0 0 0)
- For 3:1 ratio on white, foreground needs L <= ~0.58
- For 4.5:1 ratio on white, foreground needs L <= ~0.47
  </action>
  <verify>
Run build to confirm CSS is valid:
```bash
npm run build
```
Inspect generated CSS to confirm new tokens exist.
  </verify>
  <done>global.css contains --color-yellow-text, --color-turquoise-text, and dark mode variants that meet WCAG contrast requirements</done>
</task>

<task type="auto">
  <name>Task 2: Update components to use accessible text colors</name>
  <files>
    src/components/About.astro
    src/components/homepage/ContactSection.astro
    src/pages/projects/index.astro
  </files>
  <action>
1. **About.astro** - Update stat numbers (lines 29, 32):
   - Change `text-yellow` to use the new accessible text color
   - Use inline style or add utility: `style="color: var(--color-yellow-text)"`
   - For dark mode, add `.dark &` override to use `--color-yellow-text-dark`
   - Alternative: Create Tailwind utility classes `text-yellow-text` and `dark:text-yellow-text-dark` in global.css @layer utilities

2. **ContactSection.astro** - Update email link (lines 89-93):
   - Change `text-turquoise dark:text-turquoise-dark` to accessible text variants
   - Use inline style: `style="color: var(--color-turquoise-text)"` with dark mode override
   - Or add utility classes: `text-turquoise-text dark:text-turquoise-text-dark`

3. **projects/index.astro** - Fix dark mode filter button contrast (lines 30-47):
   - Inactive filter buttons currently use `text-text-light dark:text-text-dark`
   - The issue: `text-text-dark` (oklch 0.95) on `bg-transparent` with dark page background is fine
   - But `bg-transparent` shows the dark page background, and dark text on dark bg is the problem
   - Fix: Change inactive buttons from `text-text-light dark:text-text-dark` to just `text-text-light dark:text-text-dark`
   - Wait, looking at code again: the issue is `text-text-light` is dark (oklch 0.2) which won't show on dark bg
   - Current: `text-text-light dark:text-text-dark` - this should work IF text-dark is light
   - Verify: `--color-text-dark: oklch(0.95 0 0)` - this IS light, so should be visible
   - Re-check the actual issue: "dark text on dark background" suggests class might not be applying
   - ACTION: Ensure inactive buttons in dark mode get light text by verifying `dark:text-text-dark` is present and working. The current code looks correct, so this may be a Tailwind class conflict issue. If needed, add explicit `dark:text-[oklch(0.95_0_0)]` to force visibility.
  </action>
  <verify>
1. Start dev server: `npm run dev`
2. Run Playwright accessibility tests:
   ```bash
   npm run test:a11y
   ```
   Verify no new contrast violations on / (homepage), /about, /contact
3. Manually check:
   - About section stats ("10+", "50+") are visually distinct
   - Contact email link is readable
   - Projects page filter buttons visible in dark mode
  </verify>
  <done>
- About.astro stat numbers use WCAG-compliant yellow text color
- ContactSection.astro email link uses WCAG-compliant turquoise text color
- projects/index.astro filter buttons have visible text in dark mode
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify contrast fixes with axe-core</name>
  <files>tests/accessibility/axe-tests.spec.ts</files>
  <action>
1. Run the existing accessibility test suite to confirm the contrast violations are resolved:
   ```bash
   npm run test:a11y
   ```

2. If axe-core still reports violations:
   - Check the specific element and computed color values
   - Adjust OKLCH L value until contrast threshold is met
   - Use browser devtools to compute actual contrast ratio

3. If tests pass but you want to add specific contrast regression tests, add to axe-tests.spec.ts:
   - Test that About section stats pass color-contrast rule
   - Test that Contact email link passes color-contrast rule
   - This is optional since axe-core already checks these automatically

4. Run both light and dark mode tests:
   ```bash
   npm run test:a11y
   ```

Expected: All 9 tests pass (5 light mode + 4 dark mode) with no color-contrast violations.
  </action>
  <verify>
```bash
npm run test:a11y
```
Output shows all tests passing with no contrast violations.
  </verify>
  <done>axe-core accessibility tests pass with no color-contrast violations on any page</done>
</task>

</tasks>

<verification>
1. `npm run build` completes without CSS errors
2. `npm run test:a11y` passes all 9 tests with no contrast violations
3. Manual visual inspection confirms:
   - About stats are readable (darker yellow on white in light mode)
   - Email link is readable (darker turquoise on white in light mode)
   - Filter buttons are visible in both light and dark modes
4. Contrast checker tool verifies:
   - Yellow text achieves >= 3:1 ratio on white background
   - Turquoise text achieves >= 4.5:1 ratio on white background
</verification>

<success_criteria>
1. Zero color-contrast violations from axe-core on all tested pages
2. Yellow stat numbers ("10+", "50+") have >= 3:1 contrast ratio on white
3. Turquoise email link has >= 4.5:1 contrast ratio on white
4. Dark mode filter buttons have visible text (not dark-on-dark)
5. Design system maintains visual coherence (decorative elements unchanged)
</success_criteria>

<output>
After completion, create `.planning/phases/11-testing-accessibility-validation/11-03-SUMMARY.md`
</output>
