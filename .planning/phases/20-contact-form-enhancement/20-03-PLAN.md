---
phase: 20-contact-form-enhancement
plan: 03
type: execute
wave: 3
depends_on: ["20-02"]
files_modified:
  - src/components/homepage/ContactSection.astro
  - src/pages/design-system.astro
autonomous: false

must_haves:
  truths:
    - "Homepage contact form matches /contact page field set"
    - "Homepage form submits to n8n webhook and redirects to /thank-you"
    - "CheckboxGroup component documented on /design-system page"
    - "All contact form tests pass (visual and functional)"
  artifacts:
    - path: "src/components/homepage/ContactSection.astro"
      provides: "Homepage contact form with lead gen fields"
      contains: "CheckboxGroup"
    - path: "src/pages/design-system.astro"
      provides: "CheckboxGroup documentation"
      contains: "CheckboxGroup"
  key_links:
    - from: "src/components/homepage/ContactSection.astro"
      to: "n8n webhook"
      via: "fetch POST with JSON"
      pattern: "fetch.*webhookURL"
    - from: "src/components/homepage/ContactSection.astro"
      to: "/thank-you"
      via: "window.location.href redirect"
      pattern: "window.location.href.*thank-you"
---

<objective>
Update the homepage ContactSection to use the enhanced form pattern, document the CheckboxGroup component, and verify the complete contact form enhancement.

Purpose: Ensure consistency between standalone /contact page and homepage #contact section, complete design system documentation, and validate the full user flow.
Output: Updated ContactSection with all fields, CheckboxGroup in design system docs, verified form flow.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/20-contact-form-enhancement/20-CONTEXT.md
@.planning/phases/20-contact-form-enhancement/20-02-SUMMARY.md

# Source files
@src/components/homepage/ContactSection.astro
@src/pages/contact.astro
@src/pages/design-system.astro
@src/components/ui/CheckboxGroup.astro
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update homepage ContactSection</name>
  <files>src/components/homepage/ContactSection.astro</files>
  <action>
Update the homepage ContactSection to match the enhanced /contact page form. This section is embedded in the homepage, so needs self-contained JavaScript.

Changes:
1. Import CheckboxGroup component
2. Add all fields matching /contact page order:
   - Name (required)
   - Email (required)
   - Company (optional)
   - Challenges (optional, textarea)
   - Solutions (optional, CheckboxGroup)
   - Budget (optional, select)
   - Timeline (optional, select)
   - Message (required)

3. Add form ID for JavaScript targeting: id="homepage-contact-form"

4. Add inline script block with:
   - Webhook URL from import.meta.env.PUBLIC_N8N_WEBHOOK_URL
   - Form validation (same pattern as contact.astro)
   - JSON submission with cleanPayload filtering
   - Redirect to /thank-you on success
   - Error fallback message

5. Add error message containers for required fields (name-error, email-error, message-error spans)

6. Add form-level error container

7. Keep the existing "Prefer Email?" Card in the right column

Note: Use turquoise variant for inputs (matches existing design) but CheckboxGroup can use turquoise as well for consistency.
  </action>
  <verify>
1. Run `npm run dev` and visit http://localhost:4321/#contact
2. Homepage contact form shows all 8 fields matching /contact page
3. Solutions checkboxes visible in neobrutalist style
4. Submit valid form - redirects to /thank-you
5. Submit with empty required fields - inline errors appear
  </verify>
  <done>Homepage ContactSection has all 8 form fields with n8n webhook submission and /thank-you redirect</done>
</task>

<task type="auto">
  <name>Task 2: Document CheckboxGroup in design system</name>
  <files>src/pages/design-system.astro</files>
  <action>
Add CheckboxGroup documentation to the design system page, following the existing component documentation pattern.

1. Import CheckboxGroup at top of file

2. Add new section after the Input component section (or Badge section, whichever is last):

```astro
<ComponentShowcase
  title="CheckboxGroup"
  description="Accessible multi-select checkbox group with neobrutalist styling. Uses fieldset/legend for screen reader compatibility."
>
  <div slot="demo" class="space-y-8">
    <!-- Yellow variant -->
    <CheckboxGroup
      name="demo-solutions-yellow"
      legend="Example options (yellow)"
      variant="yellow"
      options={[
        { value: "opt1", label: "Option One" },
        { value: "opt2", label: "Option Two" },
        { value: "opt3", label: "Option Three" }
      ]}
    />

    <!-- Turquoise variant -->
    <CheckboxGroup
      name="demo-solutions-turquoise"
      legend="Example options (turquoise)"
      variant="turquoise"
      options={[
        { value: "opt1", label: "Option One" },
        { value: "opt2", label: "Option Two" }
      ]}
    />
  </div>

  <CodeBlock slot="code" code={`<CheckboxGroup
  name="solutions"
  legend="What solutions do you need?"
  variant="yellow"
  options={[
    { value: "AI", label: "AI" },
    { value: "Automations", label: "Automations" },
    { value: "Web Apps", label: "Web Apps" }
  ]}
/>`} />
</ComponentShowcase>
```

3. Add props table after the showcase:

| Prop | Type | Default | Description |
|------|------|---------|-------------|
| name | string | required | Form field name for checkbox values |
| legend | string | required | Accessible group label (renders in fieldset legend) |
| options | Array<{value, label}> | required | Checkbox options to render |
| variant | 'yellow' \| 'turquoise' \| 'magenta' | 'yellow' | Color variant |
| class | string | '' | Additional CSS classes |
  </action>
  <verify>
1. Run `npm run dev` and visit http://localhost:4321/design-system
2. Scroll to CheckboxGroup section
3. Demo shows two checkbox groups (yellow and turquoise variants)
4. Code example is visible and correct
5. Props table is present
  </verify>
  <done>CheckboxGroup component documented on /design-system page with demo, code example, and props table</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify complete contact form flow</name>
  <what-built>
Enhanced contact forms on both /contact page and homepage /#contact section with:
- All 8 fields (Name, Email, Company, Challenges, Solutions checkboxes, Budget, Timeline, Message)
- n8n webhook integration (placeholder URL)
- Redirect to /thank-you on success
- Inline validation errors
- Network failure email fallback
- CheckboxGroup component documented in design system
  </what-built>
  <how-to-verify>
1. Visit http://localhost:4321/contact
   - Verify all 8 fields are visible
   - Check Solutions shows 5 checkboxes (AI, Automations, Web Apps, Consultation, Not Sure)
   - Select multiple checkboxes - all should stay selected (non-exclusive)
   - Click submit with empty fields - see inline errors on Name, Email, Message only
   - Fill all required fields and submit - should redirect to /thank-you

2. Visit http://localhost:4321/thank-you
   - Verify confirmation message is displayed
   - Verify 48-hour response time is mentioned
   - Verify Calendly placeholder link is visible

3. Visit http://localhost:4321/#contact (scroll to contact section)
   - Verify same 8 fields as /contact page
   - Fill form and submit - should redirect to /thank-you

4. Visit http://localhost:4321/design-system
   - Scroll to CheckboxGroup section
   - Verify demo shows checkbox groups with neobrutalist styling
   - Verify checkboxes show shadow on checked state

5. Test dark mode toggle on all pages
   - Checkboxes should have appropriate dark mode styling
   - Form fields should remain readable
  </how-to-verify>
  <resume-signal>Type "approved" if all verifications pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
- Homepage ContactSection matches /contact page fields
- Both forms submit to webhook and redirect to /thank-you
- CheckboxGroup documented in design system
- All verification steps pass in checkpoint
</verification>

<success_criteria>
1. User can submit enhanced contact form from homepage or /contact page
2. Both forms redirect to /thank-you on success
3. CheckboxGroup component is documented with demo and props
4. No visual or functional issues in light/dark mode
</success_criteria>

<output>
After completion, create `.planning/phases/20-contact-form-enhancement/20-03-SUMMARY.md`
</output>
