---
phase: 06-performance-seo
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/layouts/BaseLayout.astro
  - src/components/Hero.astro
  - src/components/About.astro
  - src/components/BlogCard.astro
  - src/pages/portfolio.astro
  - src/pages/portfolio/[slug].astro
  - src/pages/blog/[slug].astro
autonomous: true

must_haves:
  truths:
    - "Images use WebP format with JPEG fallback"
    - "Images below the fold use lazy loading"
    - "Hero image loads eagerly (no lazy loading)"
    - "Images have responsive srcset for multiple viewport sizes"
    - "Primary fonts (Poppins, Inter) are preloaded"
  artifacts:
    - path: "src/layouts/BaseLayout.astro"
      provides: "Font preloading in head"
      contains: "rel=\"preload\""
    - path: "src/components/Hero.astro"
      provides: "Eager-loaded hero image"
      contains: "loading=\"eager\""
  key_links:
    - from: "src/components/Hero.astro"
      to: "astro:assets"
      via: "Picture component import"
      pattern: "import.*Picture.*from.*astro:assets"
---

<objective>
Optimize images with WebP/responsive srcset and preload critical fonts

Purpose: Improve Core Web Vitals (LCP, CLS) and reduce page load time
Output: Optimized image loading across all components, preloaded fonts
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-performance-seo/06-CONTEXT.md
@.planning/phases/06-performance-seo/06-RESEARCH.md

@src/layouts/BaseLayout.astro
@src/components/Hero.astro
@src/components/About.astro
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add font preloading to BaseLayout</name>
  <files>src/layouts/BaseLayout.astro</files>
  <action>
Update src/layouts/BaseLayout.astro to preload critical fonts.

Since we're using Google Fonts (not self-hosted), we optimize differently:
1. Keep the existing preconnect hints (they're correct)
2. Add fetchpriority="high" to the main Google Fonts stylesheet link
3. Add a preload for the most critical font weight if possible

However, Google Fonts dynamically generates CSS, so direct font preloading is tricky.
The better approach per RESEARCH.md:
- Keep preconnect (already there)
- Ensure font-display: swap is used (Google Fonts defaults to this with display=swap in URL)
- The existing Google Fonts URL already includes display=swap

Check the current Google Fonts link. If it doesn't have display=swap, add it.
Current URL should be:
`https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@600;700;800&display=swap`

If display=swap is already there (it is per BaseLayout), the fonts are already optimized for font-display.

Add one more optimization: dns-prefetch for fonts.gstatic.com (in addition to preconnect).

Update head section to add:
```html
<link rel="dns-prefetch" href="https://fonts.gstatic.com" />
```

This is a minor optimization but follows best practices.
  </action>
  <verify>
Read src/layouts/BaseLayout.astro
Confirm: preconnect links exist for fonts.googleapis.com and fonts.gstatic.com
Confirm: display=swap in Google Fonts URL
  </verify>
  <done>Font loading is optimized with preconnect and font-display: swap</done>
</task>

<task type="auto">
  <name>Task 2: Optimize Hero image for eager loading</name>
  <files>src/components/Hero.astro</files>
  <action>
Check src/components/Hero.astro for any images. The Hero section may currently use placeholder content without actual images.

If Hero has images:
1. Import Picture from 'astro:assets'
2. Use Picture component with:
   - formats={['webp', 'jpeg']}
   - widths={[640, 768, 1024, 1280, 1920]}
   - sizes="100vw" (hero is full width)
   - quality={80}
   - loading="eager" (above the fold)
   - fetchpriority="high"

If Hero doesn't have images (uses background color or is text-only):
- Document this in the summary
- No changes needed for Hero

Check the actual Hero.astro content first before making changes.

IMPORTANT: If images are external URLs or placeholder paths, Astro's Picture component requires local imports. For external images, use standard img tags with loading="eager".
  </action>
  <verify>
Read src/components/Hero.astro
If images exist: Confirm loading="eager" or fetchpriority="high" is set
If no images: Document in verification output
  </verify>
  <done>Hero images (if any) load eagerly to optimize LCP</done>
</task>

<task type="auto">
  <name>Task 3: Optimize portfolio and blog images for lazy loading</name>
  <files>src/components/About.astro, src/components/BlogCard.astro, src/pages/portfolio.astro, src/pages/portfolio/[slug].astro, src/pages/blog/[slug].astro</files>
  <action>
Audit these files for images and ensure lazy loading:

1. **About.astro** - May have profile photo
   - If has image: ensure loading="lazy" attribute
   - CSS filter for black & white: add `filter: grayscale(1)` to image style

2. **BlogCard.astro** - Has featured image
   - Ensure loading="lazy" on img tag
   - Add solid color background placeholder (bg-gray-200 dark:bg-gray-700)

3. **portfolio.astro** - Grid thumbnails
   - Ensure loading="lazy" on all thumbnail images
   - Add background placeholder color

4. **portfolio/[slug].astro** - Case study screenshots
   - Ensure loading="lazy" on all images (they're below fold)
   - Add background placeholder color

5. **blog/[slug].astro** - Blog post featured image and content images
   - Featured image: loading="lazy" (it's below the sticky header/title)
   - Add background placeholder

For each image found:
- If it's an img tag: add loading="lazy" attribute if not present
- If it has a wrapper div: add bg-gray-200 dark:bg-gray-700 as placeholder
- Do NOT convert to Picture component if using external URLs or onerror fallbacks (they won't work with Astro's Image optimization)

Note: The site uses placeholder images and onerror fallbacks in several places. Keep those patterns, just ensure lazy loading is enabled.
  </action>
  <verify>
Run: grep -r 'loading=' src/components/ src/pages/
Confirm: Images have loading="lazy" (except hero which should be eager)
  </verify>
  <done>All below-fold images use lazy loading with placeholder backgrounds</done>
</task>

</tasks>

<verification>
After all tasks:
1. npm run build succeeds
2. Grep for loading= attributes shows:
   - Hero: eager (if has images)
   - Other images: lazy
3. Font loading is optimized (preconnect + display=swap)
4. Background placeholders exist on image containers
</verification>

<success_criteria>
- Font preconnects in place with display=swap
- Hero images load eagerly (if present)
- All other images use loading="lazy"
- Image containers have placeholder background colors
- Build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/06-performance-seo/06-03-SUMMARY.md`
</output>
