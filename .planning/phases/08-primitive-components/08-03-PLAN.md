---
phase: 08-primitive-components
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/Button.astro
  - src/components/ui/Card.astro
autonomous: false
gap_closure: true

must_haves:
  truths:
    - "Button focus ring follows the button's rounded corners"
    - "Button focus ring scales appropriately with button size"
    - "Card shadows become soft colored glows in dark mode"
    - "Card offset shadows remain in light mode"
  artifacts:
    - path: "src/components/ui/Button.astro"
      provides: "Focus ring via box-shadow on .btn-front"
      contains: "box-shadow.*focus"
    - path: "src/components/ui/Card.astro"
      provides: "Dark mode glow effect"
      contains: "box-shadow: 0 0"
  key_links:
    - from: ".btn:focus-visible"
      to: ".btn-front"
      via: "Focus state triggers box-shadow on child element"
      pattern: ":focus-visible.*btn-front"
    - from: ":global(.dark) .card"
      to: "box-shadow: 0 0"
      via: "Dark mode overrides offset with glow"
      pattern: "dark.*card.*box-shadow.*0 0"
---

<objective>
Fix two UAT-identified CSS issues in primitive components: Button focus ring shape and Card dark mode glow effect.

Purpose: Close UAT gaps from Phase 8 verification. Both issues stem from CSS not behaving as visually expected (outline ignores border-radius, shadow color change without shadow shape change).
Output: Corrected Button.astro and Card.astro with proper focus ring and dark mode glow behavior.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/components/ui/Button.astro
@src/components/ui/Card.astro
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix Button focus ring to follow border-radius</name>
  <files>src/components/ui/Button.astro</files>
  <action>
    Replace the outline-based focus ring on `.btn:focus-visible` with a box-shadow-based approach on `.btn-front:focus-visible`.

    Current problem (lines 97-101): CSS outline does not respect border-radius. The outline is always rectangular regardless of the element's rounded corners.

    Solution approach:
    1. Remove the outline from `.btn:focus-visible`
    2. Add `:focus-visible` pseudo-class to `.btn-front` that applies a box-shadow ring
    3. Use the `:has()` selector so `.btn:focus-visible .btn-front` gets the focus ring (or use the parent focus state to style the child)

    Implementation:
    - Remove lines 97-105 (the current `.btn:focus-visible` and dark mode variant rules)
    - Add new rule: `.btn:focus-visible .btn-front` that adds a focus ring via box-shadow
    - The focus ring should be: `0 0 0 2px var(--color-bg-light), 0 0 0 4px var(--color-text-light)`
      - First shadow: 2px white gap (matches background)
      - Second shadow: 4px dark ring (the visible focus indicator)
    - Add dark mode variant: `:global(.dark) .btn:focus-visible .btn-front` with inverted colors
      - First shadow: 2px dark gap (matches dark background)
      - Second shadow: 4px light ring

    This approach:
    - Box-shadow respects border-radius on `.btn-front`
    - Ring "fits" the button because it's applied to the actual button face
    - Scales with button size naturally (box-shadow follows element bounds)
  </action>
  <verify>
    Run `npm run dev` and visit /demos/components. Tab through buttons of different sizes.
    Visually confirm the focus ring has rounded corners matching the button shape.
  </verify>
  <done>
    Focus ring on buttons is rounded, follows the button's border-radius, and appears to "fit" each button size.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix Card dark mode shadows to become glows</name>
  <files>src/components/ui/Card.astro</files>
  <action>
    Add box-shadow property override in dark mode to change the offset shadow into a glow.

    Current problem (lines 34-47): Dark mode rules change `--card-shadow` color variable but never change the `box-shadow` property. The shadow remains `6px 6px 0 var(--card-shadow)` (hard offset) instead of becoming a glow.

    Solution:
    1. In the `:global(.dark) .card` rule (line 34-37), add a box-shadow property that creates a glow effect
    2. Use `box-shadow: 0 0 20px color-mix(in oklch, var(--card-shadow) 50%, transparent)`
       - `0 0 20px`: No offset, 20px blur radius for soft glow
       - `color-mix`: 50% opacity for subtlety (per STATE.md pending todo about testing opacity)

    Implementation:
    Add to the existing `:global(.dark) .card` rule block (after line 37):
    ```css
    box-shadow: 0 0 20px color-mix(in oklch, var(--card-shadow) 50%, transparent);
    ```

    Note: The stacked card variant (`.card-stacked`) sets `box-shadow: none` so it won't be affected by this change. The stacked card's visual effect comes from pseudo-elements, not box-shadow on the main element.
  </action>
  <verify>
    Run `npm run dev` and visit /demos/components. Toggle dark mode.
    Cards should show soft colored glows instead of hard offset shadows.
  </verify>
  <done>
    Card shadows in dark mode are soft colored glows (no offset, blur effect) while light mode retains hard offset shadows.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Fixed two CSS issues:
    1. Button focus ring now uses box-shadow on .btn-front (follows border-radius)
    2. Card dark mode now has glow shadows instead of offset shadows
  </what-built>
  <how-to-verify>
    1. Visit http://localhost:4321/demos/components
    2. Tab through the buttons - focus ring should be rounded and fit each button
    3. Toggle dark mode (click the theme toggle in header)
    4. Cards should have soft colored glows instead of hard offset shadows
    5. Toggle back to light mode - cards should have hard offset shadows again
  </how-to-verify>
  <resume-signal>Type "approved" or describe any remaining issues</resume-signal>
</task>

</tasks>

<verification>
- Button focus rings are rounded and follow button shape
- Button focus rings work in both light and dark mode
- Card shadows are hard offsets in light mode
- Card shadows are soft glows in dark mode
- All button sizes show appropriately-sized focus rings
- All card variants (yellow, turquoise, magenta) show correct glow colors
</verification>

<success_criteria>
- UAT gap "Button focus ring fits the button size and follows its outline" passes
- UAT gap "Card shadows become colored glows in dark mode" passes
- No visual regressions in light mode
- WCAG 2.4.13 focus visibility maintained (contrast ratio preserved)
</success_criteria>

<output>
After completion, create `.planning/phases/08-primitive-components/08-03-SUMMARY.md`
</output>
