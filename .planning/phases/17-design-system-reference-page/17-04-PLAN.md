---
phase: 17-design-system-reference-page
plan: 04
type: execute
wave: 3
depends_on: [17-02, 17-03]
files_modified:
  - src/pages/design-system.astro
  - src/pages/design-system.json.ts
  - CLAUDE.md
autonomous: true

must_haves:
  truths:
    - "Developer can view isometric utilities (iso-shadow, iso-glow, iso-rotate) with visual examples"
    - "Developer can view shadow-to-glow dark mode transformation examples"
    - "Developer can access JSON export at /design-system.json with tokens and components"
    - "AI agents see instruction in CLAUDE.md to check design system first"
  artifacts:
    - path: "src/pages/design-system.json.ts"
      provides: "JSON API endpoint with design tokens"
      exports: ["GET"]
    - path: "src/pages/design-system.astro"
      provides: "Utilities section completed"
      contains: ["#utility-iso-shadow", "#utility-iso-glow", "#utility-iso-rotate"]
    - path: "CLAUDE.md"
      provides: "Agent instructions for design system"
      contains: "/design-system"
  key_links:
    - from: "src/pages/design-system.json.ts"
      to: "GET function"
      via: "Astro endpoint export"
      pattern: "export.*GET"
---

<objective>
Complete the Utilities section with isometric utility documentation, create JSON API endpoint, and update CLAUDE.md with design system instructions.

Purpose: Finalize design system documentation with utilities and programmatic access for AI agents.
Output: Complete utilities section, working JSON endpoint, and updated agent instructions.
</objective>

<execution_context>
@/Users/joel/.claude/get-shit-done/workflows/execute-plan.md
@/Users/joel/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/17-design-system-reference-page/17-01-SUMMARY.md
@.planning/phases/17-design-system-reference-page/17-02-SUMMARY.md
@.planning/phases/17-design-system-reference-page/17-03-SUMMARY.md

# Isometric utilities source of truth
@src/styles/global.css (lines 140-232 for isometric utilities)

# Current CLAUDE.md
@CLAUDE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Document isometric utilities with visual examples</name>
  <files>src/pages/design-system.astro</files>
  <action>
Update `/src/pages/design-system.astro` Utilities section with:

1. **Section structure:**
   - H2: "Isometric Utilities"
   - Intro explaining the utility system

2. **Isometric Shadow subsection (`#utility-iso-shadow`):**
   - H3: "Shadow Utilities"
   - Description: "Hard offset shadows in light mode, soft glows in dark mode."
   - **Before/after visual examples:**
     - Light mode: show box with `iso-shadow-sm`, `iso-shadow`, `iso-shadow-lg`
     - Use colored boxes (turquoise border) to show shadow effect
   - **Classes documented:**
     - `.iso-shadow-sm` - 3px offset
     - `.iso-shadow` - 5px offset (default)
     - `.iso-shadow-lg` - 8px offset
   - **Dark mode transformation:**
     - Visual showing same element in light vs dark mode
     - Explain: shadows become glows (0 0 Npx with color-mix)
   - **Code example:**
     ```html
     <div class="border-3 border-turquoise iso-shadow text-turquoise">
       Shadow becomes glow in dark mode
     </div>
     ```

3. **Isometric Glow subsection (`#utility-iso-glow`):**
   - H3: "Glow Utilities"
   - Description: "Explicit glow effects (always glow, regardless of theme)."
   - **Visual examples:**
     - `.iso-glow-subtle` - 15px, 20% opacity
     - `.iso-glow` - 20px, 40% opacity
     - `.iso-glow-strong` - 30px, 60% opacity
   - **Use cases:** When you want glow in light mode too
   - **Code example:**
     ```html
     <div class="iso-glow-strong text-magenta">
       Always glows
     </div>
     ```

4. **Isometric Rotate subsection (`#utility-iso-rotate`):**
   - H3: "Rotation Utilities"
   - Description: "3D isometric rotation transforms."
   - **Visual examples (show rotated boxes):**
     - `.iso-rotate` - 45째 on both axes (standard)
     - `.iso-rotate-subtle` - 30째 (less dramatic)
     - `.iso-rotate-steep` - 60째X, 45째Z (more dramatic)
   - **Face positioning classes:**
     - `.iso-face-front`, `.iso-face-top`, `.iso-face-side`
   - **Hover utilities:**
     - `.iso-hover-lift` - translateY(-8px) on hover
     - `.iso-hover-glow` - adds glow on hover
   - **Code example:**
     ```html
     <div class="iso-container">
       <div class="iso-rotate iso-shadow bg-yellow w-24 h-24">
         Isometric box
       </div>
     </div>
     ```

5. **Shadow-to-Glow Transformation section:**
   - H3: "Dark Mode Transformation"
   - Side-by-side visual: same component in light and dark mode
   - Technical explanation:
     - Light: `box-shadow: 5px 5px 0 currentColor`
     - Dark: `box-shadow: 0 0 20px color-mix(in oklch, currentColor 40%, transparent)`
   - Why this matters: maintains visual hierarchy while feeling futuristic

Per user decision: Visual before/after examples for isometric utilities.
  </action>
  <verify>
1. All shadow sizes displayed with visual examples
2. All glow intensities displayed
3. All rotation variants displayed
4. Dark mode transformation clearly shown
5. Code examples toggle correctly
6. Copy buttons work
  </verify>
  <done>
Utilities section complete with visual examples of all isometric utilities and dark mode transformation.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create JSON API endpoint at /design-system.json</name>
  <files>src/pages/design-system.json.ts</files>
  <action>
Create `/src/pages/design-system.json.ts` with:

1. **Export GET function returning Response with JSON**

2. **Tokens object structure:**
```typescript
const tokens = {
  colors: {
    primary: {
      yellow: {
        cssVar: '--color-yellow',
        oklch: 'oklch(0.85 0.18 95)',
        hex: '#ffef6a',
        dark: {
          cssVar: '--color-yellow-dark',
          oklch: 'oklch(0.80 0.16 95)',
          hex: '#f5e03b'
        }
      },
      turquoise: {
        cssVar: '--color-turquoise',
        oklch: 'oklch(0.70 0.15 195)',
        hex: '#4dd4c0',
        dark: {
          cssVar: '--color-turquoise-dark',
          oklch: 'oklch(0.65 0.13 195)',
          hex: '#2dbfaa'
        }
      },
      magenta: {
        cssVar: '--color-magenta',
        oklch: 'oklch(0.65 0.20 350)',
        hex: '#d946ef',
        dark: {
          cssVar: '--color-magenta-dark',
          oklch: 'oklch(0.60 0.18 350)',
          hex: '#c026d3'
        }
      }
    },
    text: {
      yellowText: { cssVar: '--color-yellow-text', oklch: 'oklch(0.55 0.15 95)' },
      turquoiseText: { cssVar: '--color-turquoise-text', oklch: 'oklch(0.45 0.12 195)' }
    },
    neutral: {
      bgLight: { cssVar: '--color-bg-light', oklch: 'oklch(1.0 0 0)', hex: '#ffffff' },
      bgDark: { cssVar: '--color-bg-dark', oklch: 'oklch(0.15 0 0)', hex: '#1a1a1a' },
      textLight: { cssVar: '--color-text-light', oklch: 'oklch(0.2 0 0)', hex: '#1a1a1a' },
      textDark: { cssVar: '--color-text-dark', oklch: 'oklch(0.95 0 0)', hex: '#f5f5f5' }
    }
  },
  typography: {
    families: {
      heading: 'Bricolage Grotesque',
      body: 'DM Sans'
    },
    scale: {
      xs: { rem: '0.75rem', px: '12px' },
      sm: { rem: '0.875rem', px: '14px' },
      base: { rem: '1rem', px: '16px' },
      lg: { rem: '1.125rem', px: '18px' },
      xl: { rem: '1.25rem', px: '20px' },
      '2xl': { rem: '1.5rem', px: '24px' },
      '3xl': { rem: '1.875rem', px: '30px' },
      '4xl': { rem: '2.25rem', px: '36px' }
    },
    weights: {
      h1: 800, h2: 700, h3: 600, h4: 500, body: 400
    }
  },
  components: {
    Button: {
      variants: ['yellow', 'turquoise', 'magenta'],
      sizes: ['sm', 'md', 'lg'],
      props: {
        variant: { type: 'string', default: 'yellow' },
        size: { type: 'string', default: 'md' },
        href: { type: 'string', optional: true }
      }
    },
    Card: {
      variants: ['yellow', 'turquoise', 'magenta'],
      props: {
        variant: { type: 'string', default: 'yellow' },
        stacked: { type: 'boolean', default: false }
      }
    },
    Input: {
      variants: ['yellow', 'turquoise', 'magenta'],
      props: {
        variant: { type: 'string', default: 'yellow' },
        label: { type: 'string', optional: true },
        error: { type: 'string', optional: true }
      }
    },
    Badge: {
      variants: ['yellow', 'turquoise', 'magenta'],
      props: {
        label: { type: 'string', required: true },
        value: { type: 'string', required: true },
        description: { type: 'string', optional: true },
        variant: { type: 'string', default: 'yellow' }
      }
    }
  },
  utilities: {
    shadow: ['iso-shadow-sm', 'iso-shadow', 'iso-shadow-lg'],
    glow: ['iso-glow-subtle', 'iso-glow', 'iso-glow-strong'],
    rotate: ['iso-rotate', 'iso-rotate-subtle', 'iso-rotate-steep'],
    hover: ['iso-hover-lift', 'iso-hover-glow']
  }
};
```

3. **Response with proper headers:**
```typescript
return new Response(JSON.stringify(tokens, null, 2), {
  status: 200,
  headers: {
    'Content-Type': 'application/json'
  }
});
```

Per user decision: JSON export at /design-system.json with tokens/components data.
  </action>
  <verify>
1. Visit http://localhost:4321/design-system.json in browser
2. Verify JSON response with correct Content-Type header
3. Verify all colors have OKLCH and hex values
4. Verify components list with props and variants
5. Verify utilities list
6. Run `npm run build` to verify static output
  </verify>
  <done>
JSON API endpoint returns complete design tokens and component metadata at /design-system.json.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update CLAUDE.md with design system instructions</name>
  <files>CLAUDE.md</files>
  <action>
Update `/CLAUDE.md` to add design system section:

1. **Add new section after "### Styling":**

```markdown
### Design System

**Before creating new UI elements:**
1. Check `/design-system` page for existing components
2. Use existing Button, Card, Input, Badge components from `/src/components/ui/`
3. Reference `/design-system.json` for available tokens and component props

**Available components:**
- `Button` - Neobrutalist buttons (variants: yellow, turquoise, magenta; sizes: sm, md, lg)
- `Card` - Container with colored shadow (variants + stacked option)
- `Input` - Form inputs with labels and validation
- `Badge` - Metric display badges

**Design tokens:**
- Colors: yellow, turquoise, magenta (OKLCH-based with dark mode variants)
- Typography: Bricolage Grotesque (headings), DM Sans (body)
- Isometric utilities: iso-shadow, iso-glow, iso-rotate

**Do not create new components** for functionality that existing components already provide.
```

2. **Update Styling section** to reference design system:
   - Add note: "See /design-system for full token reference"

Per user decision: Add instruction to CLAUDE.md telling agents to check design system first.
  </action>
  <verify>
1. Read CLAUDE.md and verify new Design System section exists
2. Verify components are listed with variants
3. Verify tokens are referenced
4. Verify instruction to check /design-system before creating new components
  </verify>
  <done>
CLAUDE.md updated with design system instructions for AI agents.
  </done>
</task>

</tasks>

<verification>
1. Run `npm run dev` and visit http://localhost:4321/design-system
2. Scroll to Utilities section - verify all isometric utilities documented
3. Verify visual before/after examples for shadow-to-glow transformation
4. Toggle dark mode - verify examples update correctly
5. Visit http://localhost:4321/design-system.json - verify JSON response
6. Verify JSON contains all tokens, components, and utilities
7. Read CLAUDE.md - verify design system section added
8. Run `npm run build` to verify all pages build correctly
9. Check built output includes design-system.json
</verification>

<success_criteria>
- [ ] Isometric shadow utilities documented with visual examples (sm, default, lg)
- [ ] Isometric glow utilities documented (subtle, default, strong)
- [ ] Isometric rotation utilities documented with visual examples
- [ ] Shadow-to-glow dark mode transformation explained with visuals
- [ ] /design-system.json endpoint returns valid JSON
- [ ] JSON includes all colors with OKLCH and hex values
- [ ] JSON includes all components with props and variants
- [ ] CLAUDE.md updated with design system section
- [ ] AI agents instructed to check design system first
- [ ] `npm run build` succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/17-design-system-reference-page/17-04-SUMMARY.md`
</output>
