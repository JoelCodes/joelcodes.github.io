# Plan: Stacked Card Isolation Fix

---
phase: 17-design-system-reference-page
plan: 08
type: execute
wave: 1
depends_on: []
files_modified: [src/components/ui/Card.astro]
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Stacked card example shows multi-layer depth effect"
    - "Stacked cards have visible pseudo-element layers in light mode"
    - "Stacked cards transform appropriately in dark mode"
  artifacts:
    - path: "src/components/ui/Card.astro"
      provides: "Card component with stacked variant"
      contains: ".card-stacked"
  key_links:
    - from: "Card.astro .card-stacked"
      to: "::before and ::after pseudo-elements"
      via: "stacking context (isolation: isolate)"
      pattern: "isolation:\\s*isolate"
---

<objective>
Fix stacked card pseudo-element rendering so the multi-layer depth effect is visible.

Purpose: UAT reported "stacked cards aren't showing as stacked - just flat rectangles in light mode, flat rectangles with color glow in dark mode."
Output: Stacked cards display visible layered depth effect via ::before/::after pseudo-elements.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/components/ui/Card.astro
@src/pages/design-system.astro
</context>

<tasks>

<task type="auto">
  <name>Task 1: Diagnose and fix stacked card pseudo-element visibility</name>
  <files>src/components/ui/Card.astro</files>
  <action>
1. Check `.card-stacked` CSS (around line 52-55):
   - Must have `isolation: isolate` (NOT `isolation: auto`)
   - If it says `auto`, change to `isolate`

2. Check pseudo-element styling (lines 57-76):
   - `::before` and `::after` need `z-index: -1` to render behind the card
   - They need `position: absolute` and `inset: -4px` to extend beyond card bounds
   - They need visible `border-color` values (not transparent)

3. Verify the stacking context chain:
   - Base `.card` has `isolation: isolate` (line 30) - this creates a stacking context
   - `.card-stacked` should NOT reset `box-shadow: none` if that's what creates the visual depth

4. Root cause analysis:
   - If `isolation: isolate` is already set but cards still appear flat, the issue is likely:
     a) Pseudo-elements not rendering (check `content: ''` exists)
     b) Transform not visible against same-color background
     c) Border colors too subtle to see

5. Fix: Ensure pseudo-element borders are clearly visible:
   - Light mode: `oklch(0.25 0 0 / 0.6)` and `oklch(0.25 0 0 / 0.3)` for layered effect
   - Dark mode: `oklch(0.95 0 0 / 0.6)` and `oklch(0.95 0 0 / 0.3)`
   - Consider adding slight fill color to pseudo-elements for more visibility

6. If the current CSS is correct but effect isn't visible, consider:
   - Increasing `inset` from `-4px` to `-6px` for larger offset
   - Increasing border width from `2px` to `3px`
   - Adding subtle background fill to pseudo-elements
  </action>
  <verify>
1. Run `npm run dev` and navigate to http://localhost:4321/design-system#component-card
2. Look at the "Stacked Effect" section
3. Verify turquoise and magenta stacked cards show:
   - Main card in front
   - Two border layers offset behind (4px and 8px translate)
4. Toggle dark mode - layered effect should transform to glow-based aesthetic
  </verify>
  <done>Stacked cards display visible multi-layer depth effect with pseudo-element borders clearly visible behind the main card.</done>
</task>

</tasks>

<verification>
1. Build passes: `npm run build`
2. Visual check: Stacked cards have 3 visible layers (main + 2 pseudo-elements)
3. Light mode: Offset border layers visible
4. Dark mode: Glow effect or appropriate dark mode transformation
</verification>

<success_criteria>
- `.card-stacked` has `isolation: isolate` (verified in code)
- Stacked cards show visible layered depth effect in light mode
- Stacked cards have appropriate visual treatment in dark mode
- Multi-layer depth effect is clearly distinguishable from flat cards
</success_criteria>

<output>
After completion, create `.planning/phases/17-design-system-reference-page/17-08-SUMMARY.md`
</output>
