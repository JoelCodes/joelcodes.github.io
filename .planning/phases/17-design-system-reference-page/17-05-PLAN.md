---
phase: 17-design-system-reference-page
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/design-system/CodeBlock.astro
  - src/components/ui/Card.astro
  - src/components/ui/Badge.astro
  - src/styles/global.css
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Code blocks have padding so code is not flush against container edges"
    - "Stacked cards display multi-layer depth effect with visible ::before and ::after pseudo-elements"
    - "Badge variants display in their correct accent colors (yellow, turquoise, magenta)"
  artifacts:
    - path: "src/components/design-system/CodeBlock.astro"
      provides: "Code block with internal padding"
      contains: ".code-content pre"
    - path: "src/components/ui/Card.astro"
      provides: "Stacked card with proper isolation"
      contains: "isolation: isolate"
    - path: "src/components/ui/Badge.astro"
      provides: "Badge with magenta text color"
      contains: "magenta-text"
    - path: "src/styles/global.css"
      provides: "Magenta text color variables"
      contains: "--color-magenta-text"
  key_links:
    - from: "src/components/ui/Badge.astro"
      to: "src/styles/global.css"
      via: "CSS variable reference"
      pattern: "text-magenta-text"
---

<objective>
Fix three UAT-diagnosed visual issues in the design system components.

Purpose: Close gaps identified during user acceptance testing to complete Phase 17
Output: Three targeted fixes that restore correct visual behavior for CodeBlock, Card (stacked), and Badge components
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-design-system-reference-page/17-UAT.md

@src/components/design-system/CodeBlock.astro
@src/components/ui/Card.astro
@src/components/ui/Badge.astro
@src/styles/global.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add padding to CodeBlock code content</name>
  <files>src/components/design-system/CodeBlock.astro</files>
  <action>
    Add a style block to CodeBlock.astro that targets `.code-content pre` with padding.

    Add at the end of the file, before the closing script tag:
    ```css
    <style>
      .code-content pre {
        padding: 1rem;
        margin: 0;
      }
    </style>
    ```

    This ensures the code rendered by Astro's Code component has breathing room from the container edges.
  </action>
  <verify>Run `npm run dev` and navigate to /design-system. Click "View Code" on any component - code should have visible padding from container edges.</verify>
  <done>Code blocks display with 1rem padding, not flush against edges</done>
</task>

<task type="auto">
  <name>Task 2: Fix stacked Card isolation property</name>
  <files>src/components/ui/Card.astro</files>
  <action>
    Change line 54 in Card.astro from `isolation: auto;` to `isolation: isolate;`.

    The `.card-stacked` class currently sets `isolation: auto` which breaks the stacking context needed for the ::before and ::after pseudo-elements to render as visible background layers.

    Before (line 52-55):
    ```css
    .card-stacked {
      box-shadow: none;
      isolation: auto;
    }
    ```

    After:
    ```css
    .card-stacked {
      box-shadow: none;
      isolation: isolate;
    }
    ```

    Note: The base `.card` class already has `isolation: isolate` (line 30), but `.card-stacked` was overriding it to `auto`, preventing pseudo-elements from appearing behind the card.
  </action>
  <verify>Navigate to /design-system#components. Stacked Card example should show visible offset border layers behind the main card in light mode. In dark mode, the layers should have white borders with glow effect.</verify>
  <done>Stacked cards display with multi-layer depth effect (two visible offset borders behind main card)</done>
</task>

<task type="auto">
  <name>Task 3: Fix Badge color variants</name>
  <files>src/styles/global.css, src/components/ui/Badge.astro</files>
  <action>
    **Part A: Add magenta text variables to global.css**

    In src/styles/global.css @theme block (after line 21), add:
    ```css
    --color-magenta-text: oklch(0.50 0.18 350); /* Darker magenta for light bg contrast */
    --color-magenta-text-dark: oklch(0.75 0.20 350); /* Brighter magenta for dark bg */
    ```

    **Part B: Add magenta text utility classes to global.css**

    In the @layer utilities section (after line 103), add:
    ```css
    .text-magenta-text {
      color: var(--color-magenta-text);
    }
    .dark .text-magenta-text {
      color: var(--color-magenta-text-dark);
    }
    ```

    **Part C: Update Badge.astro variant classes**

    In src/components/ui/Badge.astro, update the variantClasses object (lines 21-25):

    Before:
    ```typescript
    const variantClasses = {
      yellow: 'text-yellow-text dark:text-yellow-text-dark',
      turquoise: 'text-turquoise-text dark:text-turquoise-text-dark',
      magenta: 'text-text-light dark:text-text-dark'
    };
    ```

    After:
    ```typescript
    const variantClasses = {
      yellow: 'text-yellow dark:text-yellow-dark',
      turquoise: 'text-turquoise dark:text-turquoise-dark',
      magenta: 'text-magenta dark:text-magenta-dark'
    };
    ```

    Note: We use the brighter accent colors directly (text-yellow, text-turquoise, text-magenta) rather than the muted text variants. Badges are decorative metric displays where visual impact matters more than body text readability. The background is neutral so the bright accent colors work well.
  </action>
  <verify>Navigate to /design-system#components. Badge section should show:
    - Yellow badge with bright yellow text (not beige/muted)
    - Turquoise badge with bright teal text (not dark/muted)
    - Magenta badge with bright pink/magenta text (not black)
    Toggle dark mode - colors should remain vibrant with appropriate dark variants.</verify>
  <done>All three Badge variants display in their correct bright accent colors in both light and dark modes</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **CodeBlock padding**: Visit /design-system, click "View Code" on any component example - code has visible padding from edges
2. **Stacked Card**: Visit /design-system#components, Card section - stacked card shows layered depth effect with offset borders
3. **Badge colors**: Visit /design-system#components, Badge section - all three variants (yellow, turquoise, magenta) display in their bright accent colors

Test in both light and dark modes:
- `npm run dev`
- Navigate to /design-system
- Toggle dark mode using header button
- Verify all three fixes work in both modes

Run build to ensure no errors:
```bash
npm run build
```
</verification>

<success_criteria>
- CodeBlock pre elements have 1rem padding
- Stacked Card pseudo-elements are visible (multi-layer depth effect)
- Badge variants use bright accent colors (not muted text variants)
- All fixes work in both light and dark modes
- Build completes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/17-design-system-reference-page/17-05-SUMMARY.md`
</output>
