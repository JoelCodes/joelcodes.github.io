---
interface Props {
  variant?: 'yellow' | 'turquoise' | 'magenta';
  stacked?: boolean;
  class?: string;
}

const {
  variant = 'yellow',
  stacked = false,
  class: className = ''
} = Astro.props;
---

<div
  class={`card card-${variant} ${stacked ? 'card-stacked' : ''} ${className}`}
>
  <slot />
</div>

<style>
  .card {
    --card-shadow: var(--color-yellow);

    position: relative;
    padding: var(--spacing-neo-lg);
    border: var(--border-neo-thick) solid var(--color-text-light);
    border-radius: 0.5rem;
    background: var(--color-bg-light);
    isolation: isolate; /* Create stacking context for pseudo-elements */
    box-shadow: 6px 6px 0 var(--card-shadow);
  }

  :global(.dark) .card {
    background: var(--color-bg-dark);
    border-color: var(--color-text-dark);
    /* Dark mode: offset shadow becomes soft glow */
    box-shadow: 0 0 20px color-mix(in oklch, var(--card-shadow) 75%, transparent);
  }

  /* Variant colors - light mode */
  .card-yellow { --card-shadow: var(--color-yellow); }
  .card-turquoise { --card-shadow: var(--color-turquoise); }
  .card-magenta { --card-shadow: var(--color-magenta); }

  /* Variant colors - dark mode (use dark variants) */
  :global(.dark) .card-yellow { --card-shadow: var(--color-yellow-dark); }
  :global(.dark) .card-turquoise { --card-shadow: var(--color-turquoise-dark); }
  :global(.dark) .card-magenta { --card-shadow: var(--color-magenta-dark); }

  /* Stacked effect: background layers via pseudo-elements */
  .card-stacked {
    box-shadow: none;
    isolation: isolate;
  }

  .card-stacked::before,
  .card-stacked::after {
    content: '';
    position: absolute;
    inset: -4px;
    border: 2px solid;
    border-radius: 0.5rem;
    z-index: -1;
  }

  .card-stacked::before {
    transform: translate(4px, 4px);
    border-color: oklch(0.25 0 0 / 0.6); /* 60% opacity black - closer */
  }

  .card-stacked::after {
    transform: translate(8px, 8px);
    border-color: oklch(0.25 0 0 / 0.3); /* 30% opacity black - further */
    box-shadow: 4px 4px 0 var(--card-shadow);
  }

  :global(.dark) .card-stacked::before {
    border-color: oklch(0.95 0 0 / 0.6); /* 60% opacity white - closer */
  }

  :global(.dark) .card-stacked::after {
    border-color: oklch(0.95 0 0 / 0.3); /* 30% opacity white - further */
    box-shadow: none; /* Remove offset shadow in dark mode */
  }
</style>
