---
import type { HTMLAttributes } from 'astro/types';

interface Props extends Omit<HTMLAttributes<'input'>, 'class'> {
  variant?: 'yellow' | 'turquoise' | 'magenta';
  as?: 'input' | 'textarea' | 'select';
  label?: string;
  error?: string;
  id?: string;
  rows?: number;
  class?: string;
}

const {
  variant = 'yellow',
  as = 'input',
  label,
  error,
  id = `input-${Math.random().toString(36).slice(2, 9)}`,
  rows,
  class: className = '',
  ...rest
} = Astro.props;

const errorId = error ? `${id}-error` : undefined;
const Tag = as === 'textarea' ? 'textarea' : as === 'select' ? 'select' : 'input';
---

<div class={`input-wrapper ${className}`}>
  {label && (
    <label for={id} class="input-label">
      {label}
    </label>
  )}
  <Tag
    id={id}
    class={`input input-${variant} ${error ? 'input-error' : ''}`}
    aria-invalid={error ? 'true' : undefined}
    aria-describedby={errorId}
    rows={as === 'textarea' ? rows : undefined}
    {...rest}
  >
    {as === 'select' && <slot />}
  </Tag>
  {error && (
    <p id={errorId} class="input-error-message">
      {error}
    </p>
  )}
</div>

<style>
  .input-wrapper {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .input-label {
    font-family: var(--font-heading);
    font-size: var(--text-sm);
    font-weight: 600;
    color: var(--color-text-light);
    margin-bottom: 0.5rem;
  }

  :global(.dark) .input-label {
    color: var(--color-text-dark);
  }

  .input {
    padding: 0.75rem 1rem;
    font-family: var(--font-body);
    font-size: var(--text-base);
    color: var(--color-text-light);
    background: var(--color-bg-light);
    border: var(--border-neo) solid var(--color-text-light);
    border-radius: 0.25rem;
    transition: border-color 200ms;
    width: 100%;
  }

  /* Textarea specific styles */
  textarea.input {
    resize: vertical;
    min-height: 100px;
  }

  /* Select specific styles */
  select.input {
    cursor: pointer;
  }

  :global(.dark) .input {
    color: var(--color-text-dark);
    background: var(--color-bg-dark);
    border-color: var(--color-text-dark);
  }

  /* WCAG 2.4.13 compliant focus state: double ring technique */
  .input:focus-visible {
    outline: none;
    box-shadow: 0 0 0 2px var(--color-bg-light), 0 0 0 4px var(--color-text-light);
  }

  :global(.dark) .input:focus-visible {
    box-shadow: 0 0 0 2px var(--color-bg-dark), 0 0 0 4px var(--color-text-dark);
  }

  /* Variant accent on focus */
  .input-yellow:focus-visible {
    border-color: var(--color-yellow);
  }

  .input-turquoise:focus-visible {
    border-color: var(--color-turquoise);
  }

  .input-magenta:focus-visible {
    border-color: var(--color-magenta);
  }

  :global(.dark) .input-yellow:focus-visible {
    border-color: var(--color-yellow-dark);
  }

  :global(.dark) .input-turquoise:focus-visible {
    border-color: var(--color-turquoise-dark);
  }

  :global(.dark) .input-magenta:focus-visible {
    border-color: var(--color-magenta-dark);
  }

  /* Error state - accessible red (4.5:1 contrast) */
  .input-error {
    border-color: oklch(0.55 0.22 25) !important;
  }

  .input-error-message {
    font-size: var(--text-sm);
    color: oklch(0.55 0.22 25);
    margin: 0;
  }

  :global(.dark) .input-error {
    border-color: oklch(0.65 0.20 25) !important;
  }

  :global(.dark) .input-error-message {
    color: oklch(0.65 0.20 25);
  }
</style>
