---
interface Props {
  headings: { depth: number; slug: string; text: string }[];
}

const { headings } = Astro.props;

// Filter to h2 and h3 only
const tocHeadings = headings.filter(h => h.depth === 2 || h.depth === 3);
---

<nav class="toc hidden lg:block" aria-label="Table of contents">
  <p class="font-heading font-semibold text-sm uppercase tracking-wide mb-4 text-text-muted-light dark:text-text-muted-dark">
    On this page
  </p>
  <ul class="space-y-1">
    {tocHeadings.map(heading => (
      <li>
        <a
          href={`#${heading.slug}`}
          class={`toc-${heading.depth}`}
        >
          {heading.text}
        </a>
      </li>
    ))}
  </ul>
</nav>

<script>
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach(entry => {
        const id = entry.target.getAttribute('id');
        const tocLink = document.querySelector(`.toc a[href="#${id}"]`);

        if (entry.isIntersecting) {
          document.querySelectorAll('.toc a').forEach(link => link.classList.remove('active'));
          tocLink?.classList.add('active');
        }
      });
    },
    { rootMargin: '-80px 0px -80% 0px' }
  );

  document.querySelectorAll('article h2[id], article h3[id]').forEach(heading => {
    observer.observe(heading);
  });
</script>
